#include <stdio.h>
#include <stdint.h>

#define RSS_HASH_KEY_LENGTH 40

static uint8_t hash_key_default[RSS_HASH_KEY_LENGTH] = {
	0x6D, 0x5A, 0x56, 0xDA, 0x25, 0x5B, 0x0E, 0xC2,
	0x41, 0x67, 0x25, 0x3D, 0x43, 0xA3, 0x8F, 0xB0,
	0xD0, 0xCA, 0x2B, 0xCB, 0xAE, 0x7B, 0x30, 0xB4,
	0x77, 0xCB, 0x2D, 0xA3, 0x80, 0x30, 0xF2, 0x0C,
	0x6A, 0x42, 0xB7, 0x3B, 0xBE, 0xAC, 0x01, 0xFA,
};

static uint8_t hash_key_lan[RSS_HASH_KEY_LENGTH] = {
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x41, 0x67, 0x25, 0x3D, 0x43, 0xA3, 0x8F, 0xB0,
	0xD0, 0xCA, 0x2B, 0xCB, 0xAE, 0x7B, 0x30, 0xB4,
	0x77, 0xCB, 0x2D, 0xA3, 0x80, 0x30, 0xF2, 0x0C,
	0x6A, 0x42, 0xB7, 0x3B, 0xBE, 0xAC, 0x01, 0xFA,
};

static uint8_t hash_key_wan[RSS_HASH_KEY_LENGTH] = {
	0x00, 0x00, 0x00, 0x00, 0x41, 0x67, 0x25, 0x3D,
	0x00, 0x00, 0x00, 0x00, 0x43, 0xA3, 0x8F, 0xB0,
	0xD0, 0xCA, 0x2B, 0xCB, 0xAE, 0x7B, 0x30, 0xB4,
	0x77, 0xCB, 0x2D, 0xA3, 0x80, 0x30, 0xF2, 0x0C,
	0x6A, 0x42, 0xB7, 0x3B, 0xBE, 0xAC, 0x01, 0xFA,
};

static uint8_t test_input_default[8] = {
    66, 9, 149, 187,
    161, 142, 100, 80
};

static uint8_t test_input_lan[8] = {
    66, 66, 182, 149,
    161, 142, 100, 83
};

static uint8_t test_input_wan[8] = {
    161, 142, 100, 83,
    0, 0, 0, 0,
};

// Confirmed that it uses big-endian for packet fields
int main() {
    uint8_t* hash_key = hash_key_lan;
    uint8_t* test_input = test_input_lan;
    uint8_t hash_res[4] = {0};
    for (int byte = 0; byte < 8; byte++) {
        for (int bit = 0; bit < 8; bit++) {
            uint8_t curr_input_bit = test_input[byte] & (1 << (7-bit));
            uint8_t curr_key[4];
            for (int key_byte = 0; key_byte < 4; key_byte++) {
                curr_key[key_byte] = hash_key[key_byte + byte] << bit;
                curr_key[key_byte] += hash_key[key_byte + byte + 1] >> (8 - bit);
                if (curr_input_bit)
                    hash_res[key_byte] ^= curr_key[key_byte];
            }
        }
    }
    for (int i = 0; i < 4; i++)
        printf("%x\n", hash_res[i]);
    return 0;
}
